{% extends 'layout/base.html.twig' %}

{% block title %}Ticket Management - TicketFlow{% endblock %}

{% block body %}
{% include 'layout/header.html.twig' with {
    header_actions: '<a href="/dashboard" class="btn btn-secondary">üè† Dashboard</a><button id="logoutBtn" class="btn btn-danger">Logout</button>'
} only %}

<div class="container py-12">
    <div class="flex justify-between items-center mb-8">
        <h2>Your Tickets</h2>
        <button id="newTicketBtn" class="btn btn-primary">+ New Ticket</button>
    </div>
    
    <!-- Ticket Form -->
    <div id="ticketFormContainer" class="card mb-8 hidden">
        <h3 class="mb-4" id="formTitle">Create New Ticket</h3>
        <form id="ticketForm">
            <input type="hidden" id="ticketId" name="id">
            
            <div class="form-group">
                <label class="form-label">Title *</label>
                <input type="text" id="ticketTitle" name="title" class="form-input" required>
                <span class="form-error hidden" id="titleError"></span>
            </div>
            
            <div class="form-group">
                <label class="form-label">Description</label>
                <textarea id="ticketDescription" name="description" class="form-textarea"></textarea>
            </div>
            
            <div class="flex gap-4">
                <div class="form-group" style="flex: 1;">
                    <label class="form-label">Status *</label>
                    <select id="ticketStatus" name="status" class="form-select" required>
                        <option value="open">Open</option>
                        <option value="in_progress">In Progress</option>
                        <option value="closed">Closed</option>
                    </select>
                    <span class="form-error hidden" id="statusError"></span>
                </div>
                
                <div class="form-group" style="flex: 1;">
                    <label class="form-label">Priority</label>
                    <select id="ticketPriority" name="priority" class="form-select">
                        <option value="low">Low</option>
                        <option value="medium">Medium</option>
                        <option value="high">High</option>
                    </select>
                </div>
            </div>
            
            <div class="flex gap-4">
                <button type="submit" class="btn btn-primary" id="submitBtn">Create</button>
                <button type="button" class="btn btn-secondary" id="cancelBtn">Cancel</button>
            </div>
        </form>
    </div>
    
    <!-- Tickets Grid -->
    <div id="ticketsGrid" class="tickets-grid"></div>
    
    <!-- Empty State -->
    <div id="emptyState" class="empty-state hidden">
        <p>No tickets yet. Create your first ticket!</p>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="deleteModal" class="modal-overlay hidden">
    <div class="modal">
        <h3>Confirm Delete</h3>
        <p>Are you sure you want to delete this ticket? This action cannot be undone.</p>
        <div class="modal-actions">
            <button id="confirmDelete" class="btn btn-danger">Delete</button>
            <button id="cancelDelete" class="btn btn-secondary">Cancel</button>
        </div>
    </div>
</div>

{% include 'layout/footer.html.twig' %}
{% endblock %}

{% block javascripts %}
<script src="/js/auth.js"></script>
<script src="/js/tickets.js"></script>
<script>
    checkAuth();
    initTickets();
    document.getElementById('logoutBtn').addEventListener('click', logout);
</script>
{% endblock %}  